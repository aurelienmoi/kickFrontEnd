(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{bIWs:function(n,t,o){"use strict";o.r(t);var l=o("CcnG"),e=o("mrSG"),i=o("jqpx"),a=o("ZZ/e"),u=o("AytR"),c=o("4ZJM"),r=(o("rG3h"),o("gTw3")),s=o("TZmh"),p="https://https://kickserver.xyz",b=function(){function n(n,t,o,l,e,i){this.http=n,this.geolocation2=t,this.router=o,this.popover=l,this.modalController=e,this.document=i,this.style="mapbox://styles/sheepbild/ck4ypwvod3t241cqlza366zmc",this.lng=46.1390432,this.lat=2.434848}return n.prototype.ngOnInit=function(){this.ionicGeolocation(),this.getCustomCoordinates()},n.prototype.ionViewDidEnter=function(){this.buildMap()},n.prototype.ionViewDidLeave=function(){this.map.remove()},n.prototype.presentPopover=function(n){return e.b(this,void 0,void 0,(function(){return e.e(this,(function(t){switch(t.label){case 0:return[4,this.popover.create({component:i.a,cssClass:"popoverClass",event:n})];case 1:return[4,t.sent().present()];case 2:return[2,t.sent()]}}))}))},n.prototype.ionicGeolocation=function(){this.geolocation2.getCurrentPosition().then((function(n){console.log(n)})).catch((function(n){console.log("Error getting location",n)})),this.geolocation2.watchPosition().subscribe((function(n){}))},n.prototype.getCustomCoordinates=function(){var n=this;this.http.get(p+"/chatApp/getCoordinates").subscribe((function(t){console.log(t.object1),n.data=t.object1}))},n.prototype.buildMap=function(){var n=this;c.accessToken=u.a.mapbox.accessToken,this.map=new c.Map({container:"map",style:this.style,center:[this.lat,this.lng],zoom:4}),this.map.addControl(this.geolocate=new c.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),this.map.addControl(new c.NavigationControl),this.map.on("load",(function(t){var o=new(function(){function n(){}return n.prototype.onAdd=function(n){return this.map=n,this.container=document.createElement("ion-button"),this.container.className="my-custom-control",this.container.innerHTML='<ion-icon name="pin"></ion-icon>&nbsp;Bitmoji',this.container.setAttribute("color","dark"),this.container.setAttribute("style","position:absolute; bottom:94px; right:40px;"),this.container.setAttribute("size","small"),this.container.setAttribute("id","myCustomId"),this.container},n.prototype.onRemove=function(){this.container.parentNode.removeChild(this.container),this.map=void 0},n}());n.map.addControl(o),document.getElementById("myCustomId").addEventListener("click",(function(){n.markFunction(),n.map.removeControl(o)})),n.map.addSource("customPoint",{type:"geojson",data:n.data,cluster:!0,clusterMaxZoom:14,clusterRadius:50}),n.map.addLayer({id:"customPoint",type:"circle",source:"customPoint",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#51bbd6",100,"#f1f075",750,"#f28cb1"],"circle-radius":["step",["get","point_count"],20,100,30,750,40]}}),n.map.addLayer({id:"cluster-count",type:"symbol",source:"customPoint",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}}),n.map.addLayer({id:"unclustered-point",type:"circle",source:"customPoint",filter:["!",["has","point_count"]],paint:{"circle-color":"#5f8394","circle-radius":6,"circle-stroke-width":2,"circle-stroke-color":"#fff"}}),n.map.on("click","unclustered-point",(function(t){var o=t.features[0].geometry.coordinates.slice();for(n.userId=t.features[0].properties.userId,n.userPseudo=t.features[0].properties.pseudo,console.log(n.userId),console.log(n.userPseudo);Math.abs(t.lngLat.lng-o[0])>180;)o[0]+=t.lngLat.lng>o[0]?360:-360;n.getPlaceName(o).subscribe((function(t){console.log(t.features[0].place_name),n.placeName=t.features[0].place_name,(n.placeName=t.features[0].place_name)&&((new c.Popup).setLngLat(o).setHTML('<p style="color:grey;">'+n.userPseudo+","+n.placeName+'</p><ion-button id=\'myBtn1\' color="dark">Profil</ion-button><ion-button id=\'myBtn\' fill="clear" color="dark">Messages</ion-button>').addTo(n.map),n.createListener())}))}))}))},n.prototype.createListener=function(){var n=this;document.getElementById("myBtn1").addEventListener("click",(function(){n.router.navigate(["/contactDashboard",n.userId])})),document.getElementById("myBtn").addEventListener("click",(function(){n.presentModalMessaging(n.userId)}))},n.prototype.presentModalMessaging=function(n){return e.b(this,void 0,void 0,(function(){return e.e(this,(function(t){switch(t.label){case 0:return[4,this.modalController.create({component:s.a,componentProps:{user_id:n}})];case 1:return[4,t.sent().present()];case 2:return[2,t.sent()]}}))}))},n.prototype.markFunction=function(){var n=this;this.wantsToMark=!0,console.log("normalement c'est true putain",this.wantsToMark),this.map.once("click",(function(t){(new c.Marker).setLngLat(t.lngLat).addTo(n.map),alert("confirmer le choix du marker"),console.log(t.lngLat.lng),n.postCoordinates([t.lngLat.lng,t.lngLat.lat])}))},n.prototype.postCoordinates=function(n){this.http.post(p+"/chatApp/putCoordinates",{coordinates:n}).subscribe((function(n){console.log(n)}))},n.prototype.goBack=function(){console.log("wantstobackoff")},n.prototype.getPlaceName=function(n){return this.http.get("https://api.mapbox.com/geocoding/v5/mapbox.places/"+n+".json?types=place&access_token="+u.a.mapbox.accessToken)},n}(),d=function(){return function(){}}(),m=o("pMnS"),h=o("QLMl"),f=o("ej43"),g=o("oBZk"),k=o("wKVB"),y=o("g/Dx"),v=o("t/Na"),x=o("ZYCi"),w=o("Ip0R"),C=l.nb({encapsulation:0,styles:[["#map[_ngcontent-%COMP%]{width:100%;height:91.8%}.my-custom-control[_ngcontent-%COMP%]{text-transform:uppercase!important}.toolbarTest[_ngcontent-%COMP%]{position:absolute;bottom:50px}"]],data:{}});function L(n){return l.Fb(0,[(n()(),l.pb(0,0,null,null,1,"app-top-toolbar",[],null,null,null,h.c,h.a)),l.ob(1,245760,null,0,i.a,[a.Hb,f.a,a.a,a.Lb],null,null),(n()(),l.pb(2,0,null,null,17,"ion-header",[],null,null,null,g.Z,g.p)),l.ob(3,49152,null,0,a.C,[l.h,l.k,l.z],null,null),(n()(),l.pb(4,0,null,0,15,"ion-toolbar",[["class","kickBg"]],null,null,null,g.tb,g.J)),l.ob(5,49152,null,0,a.Db,[l.h,l.k,l.z],null,null),(n()(),l.pb(6,0,null,0,2,"ion-title",[["class","icon whiteSmoke"]],null,null,null,g.sb,g.I)),l.ob(7,49152,null,0,a.Bb,[l.h,l.k,l.z],null,null),(n()(),l.Eb(-1,0,["Carte Kick"])),(n()(),l.pb(9,0,null,0,5,"ion-buttons",[["slot","end"]],null,null,null,g.P,g.f)),l.ob(10,49152,null,0,a.m,[l.h,l.k,l.z],null,null),(n()(),l.pb(11,0,null,0,3,"ion-button",[["autoHide","false"],["class","lightKick"],["disabled","false"]],null,[[null,"click"]],(function(n,t,o){var l=!0;return"click"===t&&(l=!1!==n.component.presentPopover(o)&&l),l}),g.O,g.e)),l.ob(12,49152,null,0,a.l,[l.h,l.k,l.z],{disabled:[0,"disabled"]},null),(n()(),l.pb(13,0,null,0,1,"ion-icon",[["class","settingBtn"],["name","settings"]],null,null,null,g.ab,g.q)),l.ob(14,49152,null,0,a.D,[l.h,l.k,l.z],{name:[0,"name"]},null),(n()(),l.pb(15,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,g.P,g.f)),l.ob(16,49152,null,0,a.m,[l.h,l.k,l.z],null,null),(n()(),l.pb(17,0,null,0,2,"ion-back-button",[["autoHide","false"],["color","light"],["defaultHref","/dashboard"],["icon","ios-arrow-back"],["text",""]],null,[[null,"click"]],(function(n,t,o){var e=!0;return"click"===t&&(e=!1!==l.zb(n,19).onClick(o)&&e),e}),g.M,g.c)),l.ob(18,49152,null,0,a.h,[l.h,l.k,l.z],{color:[0,"color"],defaultHref:[1,"defaultHref"],icon:[2,"icon"],text:[3,"text"]},null),l.ob(19,16384,null,0,a.i,[[2,a.jb],a.Ib],{defaultHref:[0,"defaultHref"]},null),(n()(),l.pb(20,0,null,null,12,"ion-content",[["class","noScroll"]],null,null,null,g.X,g.n)),l.ob(21,49152,null,0,a.v,[l.h,l.k,l.z],null,null),(n()(),l.pb(22,0,null,0,0,"div",[["class","map match-parent"],["id","map"]],null,null,null,null,null)),(n()(),l.pb(23,0,null,0,7,"ion-toolbar",[["class","kickBg toolbarTest"]],null,null,null,g.tb,g.J)),l.ob(24,49152,null,0,a.Db,[l.h,l.k,l.z],null,null),(n()(),l.pb(25,0,null,0,5,"ion-title",[],null,null,null,g.sb,g.I)),l.ob(26,49152,null,0,a.Bb,[l.h,l.k,l.z],null,null),(n()(),l.pb(27,0,null,0,3,"ion-button",[["fill","clear"]],null,null,null,g.O,g.e)),l.ob(28,49152,null,0,a.l,[l.h,l.k,l.z],{fill:[0,"fill"]},null),(n()(),l.pb(29,0,null,0,1,"ion-icon",[["class","menuIcon"],["color","light"],["name","ios-arrow-up"]],null,null,null,g.ab,g.q)),l.ob(30,49152,null,0,a.D,[l.h,l.k,l.z],{color:[0,"color"],name:[1,"name"]},null),(n()(),l.pb(31,0,null,0,1,"app-nav-bar",[],null,null,null,k.b,k.a)),l.ob(32,114688,null,0,y.a,[],null,null)],(function(n,t){n(t,1,0),n(t,12,0,"false"),n(t,14,0,"settings"),n(t,18,0,"light","/dashboard","ios-arrow-back",""),n(t,19,0,"/dashboard"),n(t,28,0,"clear"),n(t,30,0,"light","ios-arrow-up"),n(t,32,0)}),null)}function M(n){return l.Fb(0,[(n()(),l.pb(0,0,null,null,1,"app-map",[],null,null,null,L,C)),l.ob(1,114688,null,0,b,[v.c,r.a,x.m,a.Lb,a.Hb,w.c],null,null)],(function(n,t){n(t,1,0)}),null)}var P=l.lb("app-map",b,M,{},{},[]),z=o("gIcY"),I=o("Yj4x"),B=o("exf7"),_=o("n8fM");o.d(t,"MapPageModuleNgFactory",(function(){return j}));var j=l.mb(d,[],(function(n){return l.wb([l.xb(512,l.j,l.bb,[[8,[m.a,h.b,P]],[3,l.j],l.x]),l.xb(4608,w.k,w.j,[l.u,[2,w.q]]),l.xb(4608,z.p,z.p,[]),l.xb(4608,a.c,a.c,[l.z,l.g]),l.xb(4608,a.Hb,a.Hb,[a.c,l.j,l.q]),l.xb(4608,a.Lb,a.Lb,[a.c,l.j,l.q]),l.xb(1073742336,w.b,w.b,[]),l.xb(1073742336,z.n,z.n,[]),l.xb(1073742336,z.b,z.b,[]),l.xb(1073742336,a.Fb,a.Fb,[]),l.xb(1073742336,x.p,x.p,[[2,x.v],[2,x.m]]),l.xb(1073742336,I.a,I.a,[]),l.xb(1073742336,B.a,B.a,[]),l.xb(1073742336,_.a,_.a,[]),l.xb(1073742336,d,d,[]),l.xb(1024,x.k,(function(){return[[{path:"",component:b}]]}),[])])}))}}]);